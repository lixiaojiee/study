#  一、从集中式到分布式

## 1、集中式的特点

所谓集中式系统就是指由一台或多台主计算机组成的中心节点，数据集中存储于这个中心节点中，并且整个系统的所有业务单元都集中部署在这个中心节点上，系统的所有功能均由其集中处理

## 2、分布式的特点

分布式系统是一个硬件或软件组件分布在不同的网络计算机上，彼此之间仅仅通过消息传递进行通信和协调的系统

分布式系统具有以下特征：

1）分布性

分布式系统中的多台计算机都会在空间上随意分布，同时，机器的分布情况也会随时变动

2）对等性

分布式系统中的计算机没有主/从之分，既没有控制整个系统的主机，也没有被控制的从机，组成分布式系统的所有计算机节点都是对等的

3）并发性

4）缺乏全局时钟

在分布式系统中，很难定义两个事件谁先谁后，原因就是因为分布式系统缺乏一个全局的时钟序列控制。

5）故障总会发生

组成分布式系统的所有计算机，都有可能发生任何形式的故障

# 二、从ACID到CAP/BASE

## 1、事物 

事物是由一系列对系统中数据进行访问与更新操作所组成的一个程序执行逻辑单元，狭义上的事物特指数据库事务

事物的四个特性（ACID）：

### a、  原子性（Atomicity）

事物的原子性指事物必须是一个原子的操作序列单元

### b、一致性（Consistency）

事物的一致性是指事物的执行不能破坏数据库数据的完整性和一致性，一个事物在执行之前和执行之后，数据库都必须处于一致性状态

### c、隔离性（Isolation）

事物的隔离性是指在并发环境中，并发的事物是相互隔离的，一个事物的执行不能被其它事物干扰。在标准SQL规范中，定义了4个事物隔离级别：

#### i、未授权读取

未授权读取也被称为未提交读，该隔离级别允许脏读取，其隔离级别最低。也就是说，一个事物可以读取到另一个事物修改但未提交的数据

#### ii、授权读取

授权读取也被称为提交读，它和未授权读取非常相近，唯一的区别就是授权读取只允许获取已经被提交的数据。也就是说，如果事物A修改了某条数据，事物B读取到了A修改的结果，此时有事物C，在事物A修改后读取和事物B修改的结果不一样，也就是允许不可重复读取

#### iii、可重复读取

可重复读取，就是保证在事物处理过程中，多次读取同一个数据时，其值都和事物开始时刻是一致的。该事物禁止了脏读和不可重复读，但可能会出现幻读

所谓幻读，就是指相同的事物操作，在前后两个时间段内执行对同一个数据项的读取，可能出现不一致的结果

#### iv、串行化

串行化是最严格的事物隔离级别。它要求所有的事物都被串行执行，即事物只能是一个接一个地串行处理，不能并发执行

### d、 持久性（Durability）

事物的持久性也被称为永久性，是指一个事物一旦提交，它对数据库中对应数据的状态变更就应该是永久性的

## 2、分布式事物

分布式事物是指事物的参与者、支持事物的服务器、资源服务器以及事物管理器分别位于分布式系统的不同节点之上

### 1）CAP定理

CAP理论告诉我们，一个分布式系统不可能同时满足一致性（C：Consistency）、可用性（A：Avaliability）和分区容错性（P：Partition tolerance）这三个基本需求，最多只能同时满足其中两项

#### a、一致性

在分布式环境中，一致性是指数据在多个副本之间是否能够保持一致的特性。也就是说，当一个系统在数据一致性的状态下执行更新操作后，应该保证系统的数据仍然处于一致的状态

在分布式系统中，如果能够做到针对一个数据项的更新操作执行成功后，所有的用户都可以读取到其最新的值，那么这样的系统就被认为具有**强一致性**

#### b、可用性

可用性是指系统提供的服务必须一直处于可用的状态，对于用户的每一个操作请求总是能够在**有限的时间内返回结果**。

#### c、分区容错性

分区容错性约束了一个分布式系统需要具有如下特性：分布式系统在遇到任何网络分区故障的时候，仍然需要能够保证对外提供满足一致性和可用性的服务，除非是整个网络环境都发生了故障

**网络分区**是指在分布式系统中，不同的节点分布在不同的子网络（机房或异地网络等）中，由于一些特殊原因导致这些子网络之间出现网络不连通的状况，但各个子网络的内部网络是正常的，从而导致整个系统的网络环境被切分成了若干个孤立的区域

### 2）BASE理论

BASE是Basically Available（基本可用）、Soft state（软状态）和Eventually consistent（最终一致性）三个短语的缩写。BASE是对CAP中一致性和可用性权衡的结果，其核心思想是即使无法做到强一致性，但每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性

#### a、基本可用

基本可用是指分布式系统在出现不可预知故障的时候，允许损失部分可用性，如响应时间上的损失、功能上的损失

#### b、弱状态

弱状态也称为软状态，和硬状态相对，是指允许系统中的数据存在中间状态，并认为该中间状态的存在不会影响系统的整体可用性，即允许系统在不同节点的数据副本之间进行数据同步的过程存在延时

#### c、最终一致性

最终一致性强调的是系统中所有的数据副本，在经过一段时间的同步后，最终能够达到一个一致的状态。

最终一致性的五种分类：

##### i、因果一致性

因果一致性是指，如果进程A在更新完某个数据项后通知了进程B，那么进程B之后对该数据项的访问都应该能够获取到进程A更新后的最新值，并且如果进程B要对该数据项进行更新操作的话，务必基于进程A更新后的最新值，即不能发生更新丢失的情况

##### ii、读己之所写

读己之所写是指，进程A更新一个数据项之后，它自己总是能够访问到更新过的最新的值

##### iii、会话一致性

系统在执行更新操作后，客户端能够在同一个会话中始终读取到该数据项的最新的值

##### iv、单调读一致性

单调读一致性是指如果一个进程冲系统中读取出一个数据项的某个值之后，那么系统对于该进程后续的任何数据访问都不应该返回更旧的值

##### v、 单调写一致性

单调写一致性是指，一个系统需要能够保证来自同一个进程的写操作被顺序地执行
